<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="css/style_type1.css">
<link rel="stylesheet" type="text/css" href="css/style_type2.css">
<link rel="stylesheet" type="text/css" href="css/style_csmp.css">
<script type="text/javascript">
	//iphone用css
	var wnu=window.navigator.userAgent;
	if(wnu.indexOf("iPhone")>0)
	{
		document.write('<link rel="stylesheet" type="text/css" href="css/style_iphone.css">');
	}
</script>
<link rel="stylesheet" type="text/css" href="css/style_csmp_sideways.css">
<meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/option.js"></script>
<script type="text/javascript" src="js/api-sample.js"></script>

</head>
<body>
	<div class="header">
		<h1 class="logo">
			<a href="index.html"><img src="images/header_logo.png"></a>
		</h1>
		<div class="menubtn">
			<label for="header_menu" class="btn">
				<span></span>
				<span></span>
				<span></span>
			</div>
		</div>
	</div>
	<div class="header_menu">
		<input type="checkbox" id="header_menu" style="display:none">
		<label for="header_menu" class="bsj"></label>
		<div class="window">
			<div class="bs">
				<div class="userdata">
					<span class="user_icon"><img src="images/sidemenu_usericon.jpg"></span>
					<span class="user_name">メニュー<!--<br><a href="setting.html">設定</a>--></span>
					<label for="header_menu" class="close">×</label>
				</div>
				<p><a href="index.html"><img src="images/sidemenu_01.jpg" alt="ホーム"></a></p>
				<p><a href="category_01.html"><img src="images/sidemenu_02.jpg" alt="緊急・お役立ち"></a></p>
				<p><a href="info.html"><img src="images/sidemenu_03.jpg" alt="お知らせ"></a></p>
				<p><a href="contact.html"><img src="images/sidemenu_04.jpg" alt="お問い合わせ"></a></p>
				<p class="httl">地域情報</p>
				<div class="area_list">
				<!--js処理-->
				</div>
			</div>	
		</div><!--//.window-->
	</div>
	<div class="header_dmy"></div>

<script type="text/javascript">
$(function(){

	var url_get_token="token/get_token";
	var token=JSession.read("token");
	
	if(token==null){
		$.ajax({
			url:API.domain+url_get_token,
			type:"post",
			data:{
				service_secret:API.service_secret,
				lisence_key:API.lisence_key
			},
			success:function(data){
				
				var result=JSON.parse(data);
				JSession.write("token",result.access_token);
				
				if('access_token' in result){
					location.reload() ;
				}
				
			}
		});
	}
});
</script>


<script type="text/javascript">
$('.menubtn').on('click', function() {
	
	//地区の処理
	var url_method="category/ditrict_list";
	var token=JSession.read("token");
	
	if(token!=null){
		$.ajax({
			url:API.domain+url_method,
			type:"post",
			data:{
				send_token:token
			},
			success:function(data){
				var result=JSON.parse(data);
				
				var ditrict_count = Object.keys(result).length;
				for(var i = 0; i < ditrict_count; i++){
					
					$(".contents_source2 a").text(result[i].name);
					$(".contents_source2 *[content_link]").attr("href",$(".contents_source2 *[content_link]").attr("hrefs")+"?id="+result[i].id);
					
					//書き換え処理
					$('.area_list').append($(".contents_source2").html());
				}
			},
			error: function(){
		       view_error_page();
    		}
			
		});
	}
	else{
		view_error_page();
	}	

});
</script>

	<div class="contents_source2" style="display:none">
		<p><a hrefs="area.html" content_link></a></p>
	</div><!--//.contents_source-->	
<div class="wrapper">
	<a href="javascript:history.back();"><h2 class="mtitle">ママ求人</h2></a>
	<h2 class="subttl m10"><!--js処理--></h2>

	<div class="waiting"></div>
	<div class="contents_area hidden">
		<p class="serch_result_text"><b>全0件</b><span>-うち0件表示-</span></p>
	</div>
	<!--//.contents_area-->
	
	<div class="pager mt10 ">
		<ul class="float pager_area">

		</ul>
	</div><!--//.wrapper-->
</div>

<script type="text/javascript">
$(function(){

	//ＵＲＬパラメータから地区ID取得とページ番号取得
	var arg  = new Object;
	url = location.search.substring(1).split('&');
	for(i=0; url[i]; i++) {
		var k = url[i].split('=');
		arg[k[0]] = k[1];
	}
	var ditrict_id = arg.id;
	
	if('page' in arg){
		var page_num = arg.page;
	}else{
		var page_num = 1;
	}
	
		
	//地区の処理
	var url_method="category/ditrict_name";
	var token=JSession.read("token");
	
	if(token!=null){
		$.ajax({
			url:API.domain+url_method,
			type:"post",
			data:{
				send_token:token,
				id:ditrict_id,
			},
			success:function(data){
				var result=JSON.parse(data);
				//console.log(result[0].name);
				
				$(".subttl").text(result[0].name);
				
			}
		});
	}
	else{
		view_error_page();
	}
	
	//コンテンツの処理
	var url_method="contents/contents_list";
	var token=JSession.read("token");
	
	if(token!=null){
		$.ajax({
			url:API.domain+url_method,
			type:"post",
			data:{
				send_token:token,
				id:ditrict_id,
				cid:"2",					//カテゴリー指定【個別設定】
				page:page_num,
			},
			success:function(data){

				$(".contents_area").animate({
					"opacity":1,
					"-webkit-opacity":1,
					"-moz-opacity":1,
					"-ms-opacity":1,
					"-o-opacity":1,
				},500);

				$(".waiting").animate({
					"opacity":0,
					"-webkit-opacity":0,
					"-moz-opacity":0,
					"-ms-opacity":0,
					"-o-opacity":0,
				},300);

				var result=JSON.parse(data);
				console.log(result);
				
				
				var item_count = Object.keys(result).length - 4;				
			
				for(var i = 0; i < item_count; i++){		
					//一部Jsonパース
					var caption = JSON.parse(result[i]["Contents"].caption);//console.log(caption);
					
					
					//テンプレに記入	
					$(".copy_base .item .k02").text(caption.text1);									
					$(".copy_base .item .k03").text(result[i]["Contents"].title);
					$(".copy_base .item .k04").text(caption.text5);
					$(".copy_base .item .s00 img").attr("src",result[i]["Contents"].content);
					$(".copy_base *[content_link]").attr("href",$(".copy_base *[content_link]").attr("hrefs")+"?id="+result[i]["Contents"].id);					
								
							
					//書き換え処理
					$('.contents_area').append($(".copy_base").html());
					
				}

				//ページャー処理
				$(".serch_result_text b").text("全 "+result.totalcount+" 件");
				$(".serch_result_text span").text("-うち"+item_count+"件表示-");

				if(result.totalpage>1){

						if(page_num!=1){
							$('.copy_pager a').html("&lt;");
							$(".copy_pager *[content_link]").attr("href","category_03_arealist.html"+"?id="+ditrict_id+"&page="+ (parseInt(page_num)-1) );
							
							$('.pager_area').append($(".copy_pager").html());	
						}
										
						//表示はページャの5個まで
						if(page_num>2){
							if(result.totalpage-page_num+1 > 3){var view_limit = 3;}else{var view_limit = result.totalpage-page_num+1;}
						}
						else if(page_num>1){
							if(result.totalpage-page_num+1 > 4){var view_limit = 4;}else{var view_limit = result.totalpage-page_num+1;}
						}
						else{
							if(result.totalpage-page_num+1 > 5){var view_limit = 5;}else{var view_limit = result.totalpage-page_num+1;}
						}
						
						if(page_num>2){
							
							$('.copy_pager a').html( (parseInt(page_num)-2) );
							$(".copy_pager *[content_link]").attr("href","category_03_arealist.html"+"?id="+ditrict_id+"&page="+ (parseInt(page_num)-2) );
							$('.pager_area').append($(".copy_pager").html());
	
						}
						if(page_num>1){
							
							$('.copy_pager a').html( (parseInt(page_num)-1) );
							$(".copy_pager *[content_link]").attr("href","category_03_arealist.html"+"?id="+ditrict_id+"&page="+ (parseInt(page_num)-1) );
							$('.pager_area').append($(".copy_pager").html());
	
						}						
						
						for(i=0;i<view_limit; i++){
						
							if(i==0){  $('.copy_pager li').addClass("active");  }
							else{  $('.copy_pager li').removeClass("active");  }
							
							$('.copy_pager a').html( (parseInt(page_num)+i) );
							$(".copy_pager *[content_link]").attr("href","category_03_arealist.html"+"?id="+ditrict_id+"&page="+ (parseInt(page_num)+i) );
							
							$('.pager_area').append($(".copy_pager").html());				
						}
						
						if( page_num < result.totalpage){
							$('.copy_pager a').html("&gt;");
							$(".copy_pager *[content_link]").attr("href","category_03_arealist.html"+"?id="+ditrict_id+"&page="+ (parseInt(page_num)+1) );
							
							$('.pager_area').append($(".copy_pager").html());	
						}
						
				}	
	
			}
		});
	}
	else{
		view_error_page();
	}	
	
});
</script>

	<div class="copy_base" style="display:none;">
		<div class="item">
			<a hrefs="job_detail.html" content_link>
			<div class="bs">
				<div class="s00" style=""><img src=""></div>
				<div class="s01">
					<p class="k02"></p>
					<h3 class="k03"></h3>
					<p class="subc k04"></p>
					<p class="subc red k05"></p>
				</div>
			</div>
			</a>
		</div>
		<!--//.item-->
	</div>

	<div class="copy_pager" style="display:none;">
		<li class="pager"><a content_link></a> </li>
	</div>

<div id="popup">
	<div class="basejavar"></div>
</div>
<script type="text/javascript">
$(window).load(function () {
	$(".toppage").css({
		"display":"block",
		"opacity":0,
		"-webkit-opacity":0,
		"-moz-opacity":0,
		"-ms-opacity":0,
		"-o-opacity":0,
	}).animate({
		"opacity":1,
		"-webkit-opacity":1,
		"-moz-opacity":1,
		"-ms-opacity":1,
		"-o-opacity":1,
	},500);

	$(".wrapper").css({
		"display":"block",
		"opacity":0,
		"-webkit-opacity":0,
		"-moz-opacity":0,
		"-ms-opacity":0,
		"-o-opacity":0,
	}).animate({
		"opacity":1,
		"-webkit-opacity":1,
		"-moz-opacity":1,
		"-ms-opacity":1,
		"-o-opacity":1,
	},500);

});
</script>


</div>

<div class="footer_dmy"></div>
<div class="footer">
	<ul class="float">
		<a href="index.html" class="icon01 "></a>
		<a href="category_01.html" class="icon02 "></a>
		<a href="info.html" class="icon03 "></a>
		<a href="contact.html" class="icon04 "></a>
	</ul>
</div>

</body>
</html>