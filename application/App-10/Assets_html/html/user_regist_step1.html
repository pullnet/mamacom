<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="css/style_type1.css">
<link rel="stylesheet" type="text/css" href="css/style_type2.css">
<link rel="stylesheet" type="text/css" href="css/style_typeapp.css">
<link rel="stylesheet" type="text/css" href="css/style_typeapp_responsive.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/option.js"></script>
<script type="text/javascript" src="js/api-sample.js"></script>
</head>
<body id="XXXXXXXXX">
<div class="body">
<input type="checkbox" id="alert-message" class="hidden">
<div class="alert-message">
	<p></p>
	<label for="alert-message" class="close">×</label>
</div>
<header>
	<label for="side_menu" class="menu_btn">▼</label>
	<div class="title">新規会員登録</div>
</header>
<div class="sidemenu">
	<input type="checkbox" id="side_menu" class="hidden">
	<label for="side_menu" class="bsj"></label>
	<div class="menu">
		<div class="m10">
			<div class="auth">
				<div class="user">
					<img src="" class="image image_usericon" auth-usericon>
					<h3 class="username" auth-username></h3>
				</div>
				<p><a href="index.html">TOPページ</a></p>
				<p><a href="uac_setting.html">会員情報変更</a></p>
				<p><label class="btn_logout">ログアウト</label></p>
			</div>
			<div class="no_auth">
				<p>まだログインしていないです....</p>
				<p><a href="index.html">TOPページ</a></p>
				<p><a href="login.html">ログイン</a></p>
				<p><a href="user_regist_step1.html" class="userregist_btn">新規会員登録</a></p>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
$(function(){

	var url_get_token="token/get_token";
	var token=JSession.read("token_"+API.authcode);
	if(token==null){
		$.ajax({
			url:API.domain+url_get_token,
			type:"post",
			data:{
				service_secret:API.service_secret,
				lisence_key:API.lisence_key
			},
			success:function(data){
				var result=JSON.parse(data);

				JSession.write("token_"+API.authcode,result.access_token);
			}
		});
	}
	var authdata=LSession.read("auth_"+API.authcode);

	var url_check_auth="v1a/check_auth";
	var url_logout="v1a/logout";

	if(authdata!=null){
		$(".auth").css("display","");
		$(".no_auth").css("display","none");

		$("*[auth-username]").text(authdata.username);
		$("*[auth-usericon]").text(authdata.user_icon_path);
		$("img[auth-usericon]").attr("src",authdata.user_icon_path);
		$("*[auth-mailaddress]").text(authdata.mailaddress);
	}
	else
	{
		$(".auth").css("display","none");
		$(".no_auth").css("display","");
	}

	//ログアウト
	$(".btn_logout").on("click",function(){

		$.ajax({
			url:API.domain+url_logout,
			type:"post",
			data:{
				access_token:JSession.read("token_"+API.authcode)
			},
			success:function(data){
				var result=JSON.parse(data);

				if(result.mode==200){
					LSession.delete("auth_"+API.authcode);
					location.href="login.html";
				}
			}
		});

	});

	//新規会員登録前処理(Sessionキャッシュの削除)
	$(".userregist_btn").on("click",function(){
		var href=$(this).attr("href");

		JSession.delete("post_cash");

		location.href=href;
		return false;
	});

});
</script>
<div class="hdmy"></div>
<div class="body">
	<form class="submit_form">
		<input type="hidden" name="service_secret">
		<input type="hidden" name="lisence_key">
		<div class="absolute_area">
			<div class="tr">
				<div class="t_cell">
					<div class="m10">
						<dl class="form">
							<dt class="need">メールアドレス</dt>
							<dd>
								<input type="text" name="mailaddress">
								<div class="error-message" name="mailaddress"></div>
							</dd>
							<dt class="need">ご希望のユーザー名</dt>
							<dd>
								<input type="text" name="username" placeholder="username....">
								<div class="error-message" name="username"></div>
							</dd>
							<dt class="need">ご希望のパスワード</dt>
							<dd>
								<input type="password" name="password">
								<div class="error-message" name="password"></div>
							</dd>
							<dt>アイコン画像</dt>
							<dd>
								<div class="mb10">
									<div class="image_w70">
										<img src="images/sample.png" class="image image_output_view">
									</div>
								</div>
								<input type="hidden" name="user_icon" class="image_output_input">
								<input type="hidden" name="user_icon_path" class="image_output_path">
								<input type="hidden" name="user_icon_changed" class="image_output_changed">
								<label for="edit_image" class="buttons new">アイコン画像を選択</label>
							</dd>
						</dl>
						<div class="error-message total"></div>
					</div>
				</div>
			</div>
			<div class="tr h50 controls">
				<div class="t_cell middle">
					<div class="m5">
						<ul class="float">
							<li><a href="index.html" class="buttons">戻る</a></li>
							<li class="f_right"><input type="submit" value="確認画面へ" class="buttons submit_btn"></li>
						</ul>
					</div>
				</div>


			</div>
		</div>
	</form>
</div>
<script type="text/javascript">
$(function(){
	
	//URL list
	var url_submit="v1a/user_regist_pre";
	var url_redirect="user_regist_step2.html";

	var post_cash=JSession.read("post_cash");

	if(post_cash!=null){
		$(".submit_form .image_output_view").attr("src",post_cash.user_icon_path);
		$(".submit_form input[name=mailaddress]").val(post_cash.mailaddress);
		$(".submit_form input[name=username]").val(post_cash.username);
		$(".submit_form input[name=user_icon]").val(post_cash.user_icon);
		$(".submit_form input[name=user_icon_path]").val(post_cash.user_icon_path);
		$(".submit_form input[name=user_icon_changed]").val(post_cash.user_changed);
	}

	//SUBMIT...

	$(".submit_btn").on("click",function(){

		$(".error-message").removeClass("active").text("");

		var post=$(".submit_form").Formdat();
		post.access_token=JSession.read("token_"+API.authcode);
		
		$.ajax({
			url:API.domain+url_submit,
			type:"post",
			data:post,
			success:function(data){
				var result=JSON.parse(data);

				if(result.mode==200){
					//go next
					JSession.write("post_cash",result.cash);
					location.href=url_redirect;
				}
				else{
					if(result.validate){
						var colums=Object.keys(result.validate);
						for(var us=0;us<colums.length;us++){
							$(".error-message[name="+colums[us]+"]").addClass("active").text(result.validate[colums[us]]);
						}
						$(".error-message.total").addClass("active").text("入力に誤りがあります。再度ご確認ください");
					}
				}
			}
		});

		return false;
	});
});
</script>
<style>
#XXXXXXXXX #Modalslide.image_editor .window .image_area{
	width:90%;
	padding:25px;
	margin:0px auto;
	position:relative;
	margin-bottom:30px;
}
#XXXXXXXXX #Modalslide.image_editor .window .image_area .control a{
	position:absolute;
	background:#e0e0e0;
	border:solid 1px #aaa;
}
#XXXXXXXXX #Modalslide.image_editor .window .image_area .control a:hover{
	opacity:1;
	-webkit-opacity:1;
	-moz-opacity:1;
	-ms-opacity:1;
	-o-opacity:1;
}
#XXXXXXXXX #Modalslide.image_editor .window .image_area .control a.snap_left{
	left:0px;
	top:30%;
	height:40%;
	width:20px;
}
#XXXXXXXXX #Modalslide.image_editor .window .image_area .control a.snap_top{
	left:30%;
	top:0px;
	height:20px;
	width:40%;
}
#XXXXXXXXX #Modalslide.image_editor .window .image_area .control a.snap_right{
	right:0px;
	top:30%;
	width:20px;
	height:40%;
}
#XXXXXXXXX #Modalslide.image_editor .window .image_area .control a.snap_bottom{
	right:30%;
	bottom:0px;
	width:40%;
	height:20px;
}
#XXXXXXXXX #Modalslide.image_editor .window .image_area .control a.rotation{
	right:-20px;
	text-align:center;
	bottom:-30px;
	width:60px;
	height:25px;
	color:#333;
	line-height:25px;
}
#XXXXXXXXX #Modalslide.image_editor .window .trim{
	padding-bottom:100%;
	position:relative;
	overflow:hidden;
	border:solid 1px #ccc;
	}
#XXXXXXXXX #Modalslide.image_editor .window .trim .image_source{
	position:absolute;
	left:0px;
	top:0px;
	width:100%;
}
#XXXXXXXXX #Modalslide.image_editor .window .progressbar{
	background:#999;
	height:20px;
	position:relative;
	overflow:hidden;
}
#XXXXXXXXX #Modalslide.image_editor .window .progressbar .value{
	position:absolute;
	width:0%;
	left:0px;
	top:0px;
	height:20px;
	background:#36c;
}
#XXXXXXXXX #Modalslide.image_editor .window #html_image_defaultlist{
	margin-right:-5px;
}
#XXXXXXXXX #Modalslide.image_editor .window #html_image_defaultlist div{
	float:left;
	width:33.3%;
}
#XXXXXXXXX #Modalslide.image_editor .window #html_image_defaultlist div p{
	margin-right:5px;
	margin-bottom:5px;
}
#XXXXXXXXX #Modalslide.image_editor .window #html_image_defaultlist div img{
	width:100%;
		display:block;
}
</style>
<div class="hidden">
	<form enctype="multipart/form-data" id="image_editor_buffer">
		<input type="hidden" name="access_token" value="" hidden-access_token>
		<input type="file" name="file" id="edit_setfile" accept="image/*">
	</form>
</div>
<div id="Modalslide" class="image_editor">
	<input type="checkbox" id="edit_image" class="checks">
	<table class="window">
	<tr>
		<td class="hf head">
			<div class="float h4">
				画像の設定				<label for="edit_image" class="f_right h4">×</label>
			</div>
		</td>
	</tr>
	<tr>
		<td class="main">
			<div class="bs">
				<div class="m10">
					<div class="step1">
						<p class="mb10">下記より画像ファイルを選択して下さい</p>
						<label onclick='$("#edit_setfile").click();' class="buttons new">ギャラリーからファイルを選択</label>
											</div>
					<div class="waiting" style="display:none">
						<div class="icon">
							<p></p>
							<p></p>
							<p></p>
							<p></p>
							<p></p>
							<p></p>
							<p></p>
							<p></p>
							<span>Loading..</span>
						</div>
					</div>
					<div class="step2" style="display:none">
						<p>タップしてトリミング位置を調整してください</p>
						<div class="image_area">
							<div class="trim">
								<img class="image_source">
							</div>
							<ul class="control">
								<li><a class="snap_left"></a></li>
								<li><a class="snap_top"></a></li>
								<li><a class="snap_right"></a></li>
								<li><a class="snap_bottom"></a></li>
															</ul>
						</div>
						<p>下記のバーで拡大縮小することができます。</p>
						<div class="progressbar zoom mb10">
							<div class="value"></div>
						</div>

						<a class="underline image_clear">クリアにする</a>
				
						<form enctype="multipart/form-data" id="image_editor_form">
							<input type="hidden" name="access_token" value="" hidden-access_token>
							<input type="hidden" name="buffer" id="hidden_buffer">
							<input type="hidden" name="output_width" value="300">
							<input type="hidden" name="output_height" value="300">
							<input type="hidden" name="trim_width" id="hidden_trim_width">
							<input type="hidden" name="trim_height" id="hidden_trim_height">
							<input type="hidden" name="offset_left" id="hidden_offset_left">
							<input type="hidden" name="offset_top" id="hidden_offset_top">
							<input type="hidden" name="zoom" id="hidden_zoom">
						</form>
					</div>
				</div>
			</div>
		</td>
	</tr>
	<tr>
		<td class="hf">
			<ul class="float">
				<li><label for="edit_image" class="buttons">キャンセル</label></li>
				<li class="f_right"><a class="buttons btn_submit" style="display:none">決定する</a></li>
			</ul>
		</td>
	</tr>
	</table>
</div><!--//#Modalslide-->

<div class="hidden">
	<div id="default_image"></div>
	<div id="url_domain_item"></div>
	<div id="url_image_defaultsave">ups/get_imagelist_save</div>
</div>
<script type="text/javascript">
$(function(){

	$("*[hidden-access_token]").val(JSession.read("token_"+API.authcode));

	var url={
		image_edit:"ups/fileup/true",
		image_editbuffer:"ups/fileup_buffer",
		image_defaultlist:"ups/get_imagelist",
		image_defaultsave:"ups/get_imagelist_save"
	};

	$(window).on("resize",function(){
		$("#hidden_trim_width").val($(".image_editor .image_area").width());
		$("#hidden_trim_height").val($(".image_editor .image_area").height());
	});

	if($("#default_image").text()){
		$.ajax({
			url:url.image_defaultlist+"/"+$("#default_image").text(),
			success:function(data){
				var result=JSON.parse(data);
				
				var html="";
				for(var v1=0;v1<result.length;v1++){
					var path=$("#url_domain_item").text()+"wdata/"+result[v1].path;
					var html_buff='<div><p><a class="select_image" data-path="'+path+'" data-filename="'+result[v1].name+'"><img src="'+path+'"></a></p></div>';
					html+=html_buff;
				}
				$("#html_image_defaultlist").html(html);
			}
		});
	}

	$("body").on("click",".select_image",function(){
		var path=$(this).attr("data-path");
		var name=$(this).attr("data-filename");

		$.ajax({
			url:$("#url_image_defaultsave").text()+"/"+name,
			success:function(data){
				var result=JSON.parse(data);

				$(".image_output_view").attr("src",result.path+"?"+result.uniqId);
				$(".image_output_input").val(result.tag);
				$(".image_output_path").val(result.path);
				$(".image_output_changed").val(1);

				$("#edit_image").prop("checked",false);
			}
		});


	});

	$("#edit_setfile").on("change",function(){

		$.ajax({
			url:API.domain+url.image_editbuffer,
			type:"post",
			processData:false,
			contentType:false,
			async:true,
			data:new FormData($("#image_editor_buffer").get(0)),
			beforeSend:function(){
				$(".image_editor .step1").css("display","none");
				$(".image_editor .step2").css("display","none");
				$(".image_editor .waiting").css("display","");
			},
			success:function(data){
				var result=JSON.parse(data);

				$(".image_editor .image_source").attr("src",result.path+"?"+result.uniqId);
				$("#hidden_buffer").val(result.path);

				$(".image_editor .step1").css("display","none");
				$(".image_editor .waiting").css("display","none");
				$(".image_editor .step2").css("display","");

				$(".image_editor .trim .image_source").css({
					"top":"0px",
					"left":"0px",
				});

				$("#hidden_trim_width").val($(".image_editor .image_area").width());
				$("#hidden_trim_height").val($(".image_editor .image_area").height());
				$("#hidden_offset_left").val(0);
				$("#hidden_offset_top").val(0);
				$("#hidden_zoom").val(1);

				$(".image_editor .zoom .value").css({
					"width":"0%",
				});

				$(".image_editor .image_source").css("width","100%");
				$("#hidden_zoom").val(1);

				$(".btn_submit").css("display","");
			}
		});
	});

	var touch_enabled=false;
	var start_y=0;
	var start_x=0;
	var zoom=0;
	
	$(".image_editor .trim").on("touchstart",function(event){
		start_x=event.originalEvent.touches[0].clientX;
		start_y=event.originalEvent.touches[0].clientY;
		return false;
	});
	$(".image_editor .trim").on("touchmove",function(event){
		var vectol_y=start_y-event.originalEvent.touches[0].clientY;
		var vectol_x=start_x-event.originalEvent.touches[0].clientX;
		start_y=event.originalEvent.touches[0].clientY;
		start_x=event.originalEvent.touches[0].clientX;
		$(".image_editor .trim .image_source").css({
			"top":parseInt($(".image_editor .trim .image_source").css("top"))- vectol_y+"px",
			"left":parseInt($(".image_editor .trim .image_source").css("left"))- vectol_x+"px",
		});

	//	$(".view_offset_left").text(parseInt($(".image_editor .trim .image_source").css("left"))- vectol_x+"px");
	//	$(".view_offset_top").text(parseInt($(".image_editor .trim .image_source").css("top"))- vectol_y+"px");

	//	$(".view_width").text($(".image_editor .image_area").width());
	//	$(".view_height").text($(".image_editor .image_area").height());
		
		$("#hidden_offset_left").val(parseInt($(".image_editor .trim .image_source").css("left"))- vectol_x);
		$("#hidden_offset_top").val(parseInt($(".image_editor .trim .image_source").css("top"))- vectol_y);
	});

	$(".image_editor .zoom").on("touchstart",function(event){
		zoom=event.originalEvent.touches[0].clientX;
		return false;
	});
	$(".image_editor .zoom").on("touchmove",function(event){
		var vx=event.originalEvent.touches[0].clientX-$(this).offset().left;
		var p_left=parseInt(vx/$(".image_editor .zoom").width()*100);

		$(".image_editor .zoom .value").css({
			"width":p_left+"%",
		});
		$(".image_editor .image_source").css("width",(p_left*4)+100+"%");

	//	$(".view_zoom").text((p_left*4)/100+1);

		$("#hidden_zoom").val((p_left*4)/100+1);
	});

	$(".image_clear").on("click",function(){
		$(".getfiles").val("");
		$(".image_editor .step1").css("display","");
		$(".image_editor .step2").css("display","none");

		$(".btn_submit").css("display","none");

	});

	//submit...
	$(".btn_submit").on("click",function(){
		$.ajax({
			url:API.domain+url.image_edit,
			type:"post",
			processData:false,
			contentType:false,
			async:false,
			data:new FormData($("#image_editor_form").get(0)),
			success:function(data){
				var result=JSON.parse(data);

				$(".image_output_view").attr("src",result.path);
				$(".image_output_input").val(result.tag);
				$(".image_output_path").val(result.path);
				$(".image_output_changed").val(1);
				
				$("#edit_image").prop("checked",false);
				
			}
		});
	});

	//offset left

	$(".image_editor .snap_left").on("click",function(){

		$(".image_editor .trim .image_source").css({
			"left":"0px",
		});

		$("#hidden_offset_left").val(0);
	
	});

	//offset top
	$(".image_editor .snap_top").on("click",function(){

		$(".image_editor .trim .image_source").css({
			"top":"0px",
		});

		$("#hidden_offset_top").val(0);
	
	});
	//offset right
	$(".image_editor .snap_right").on("click",function(){

		$(".image_editor .trim .image_source").css({
			"left":-($(".image_editor .trim .image_source").width()-$(".image_editor .trim").width())+"px",
		});

		$("#hidden_offset_left").val(parseInt($(".image_editor .trim .image_source").css("left")));
	});
	//offset bottom
	$(".image_editor .snap_bottom").on("click",function(){
	
		$(".image_editor .trim .image_source").css({
			"top":-($(".image_editor .trim .image_source").height()-parseInt($(".image_editor .trim").css("height")))+"px",
		});

		$("#hidden_offset_top").val(parseInt($(".image_editor .trim .image_source").css("top")));

	});
});
</script>
</body>
</html></div><!--//.body-->
<div id="Modal">
<div class="basejavar"></div>
</div>
</body>
</html>