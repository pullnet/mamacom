<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="css/style_type1.css">
<link rel="stylesheet" type="text/css" href="css/style_type2.css">
<link rel="stylesheet" type="text/css" href="css/style_typeapp.css">
<link rel="stylesheet" type="text/css" href="css/style_typeapp_responsive.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/option.js"></script>
<script type="text/javascript" src="js/api-sample.js"></script>
</head>
<body id="XXXXXXXXX">
<div class="body">
<input type="checkbox" id="alert-message" class="hidden">
<div class="alert-message">
	<p></p>
	<label for="alert-message" class="close">×</label>
</div>
<header>
	<label for="side_menu" class="menu_btn">▼</label>
	<div class="title">Table1の登録・編集</div>
</header>
<div class="sidemenu">
	<input type="checkbox" id="side_menu" class="hidden">
	<label for="side_menu" class="bsj"></label>
	<div class="menu">
		<div class="m10">
			<div class="auth">
				<div class="user">
					<img src="" class="image image_usericon" auth-usericon>
					<h3 class="username" auth-username></h3>
				</div>
				<p><a href="index.html">TOPページ</a></p>
				<p><a href="uac_setting.html">会員情報変更</a></p>
				<p><label class="btn_logout">ログアウト</label></p>
			</div>
			<div class="no_auth">
				<p>まだログインしていないです....</p>
				<p><a href="index.html">TOPページ</a></p>
				<p><a href="login.html">ログイン</a></p>
				<p><a href="user_regist_step1.html" class="userregist_btn">新規会員登録</a></p>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
$(function(){

	var url_get_token="token/get_token";
	var token=JSession.read("token_"+API.authcode);
	if(token==null){
		$.ajax({
			url:API.domain+url_get_token,
			type:"post",
			data:{
				service_secret:API.service_secret,
				lisence_key:API.lisence_key
			},
			success:function(data){
				var result=JSON.parse(data);

				JSession.write("token_"+API.authcode,result.access_token);
			}
		});
	}
	var authdata=LSession.read("auth_"+API.authcode);

	var url_check_auth="v1a/check_auth";
	var url_logout="v1a/logout";

	if(authdata!=null){
		$(".auth").css("display","");
		$(".no_auth").css("display","none");

		$("*[auth-username]").text(authdata.username);
		$("*[auth-usericon]").text(authdata.user_icon_path);
		$("img[auth-usericon]").attr("src",authdata.user_icon_path);
		$("*[auth-mailaddress]").text(authdata.mailaddress);
	}
	else
	{
		$(".auth").css("display","none");
		$(".no_auth").css("display","");
	}

	//ログアウト
	$(".btn_logout").on("click",function(){

		$.ajax({
			url:API.domain+url_logout,
			type:"post",
			data:{
				access_token:JSession.read("token_"+API.authcode)
			},
			success:function(data){
				var result=JSON.parse(data);

				if(result.mode==200){
					LSession.delete("auth_"+API.authcode);
					location.href="login.html";
				}
			}
		});

	});

	//新規会員登録前処理(Sessionキャッシュの削除)
	$(".userregist_btn").on("click",function(){
		var href=$(this).attr("href");

		JSession.delete("post_cash");

		location.href=href;
		return false;
	});

});
</script>
<div class="hdmy"></div>
<div class="body">
	<form class="submit_form">
		<input type="hidden" name="id">
		<div class="absolute_area">
			<div class="tr">
				<div class="t_cell">
					<div class="m10">
						<dl class="form">
							<dt class="need">レコード名</dt>
							<dd>
								<input type="text" name="name">
								<div class="error-message" name="name"></div>
							</dd>
							<dt class="need">項目名AAA</dt>
							<dd>
								<input type="text" name="colum_a1" claas="w150">
								<div class="error-message" name="colum_a1"></div>
							</dd>
							<dt>項目名BBB</dt>
							<dd>
								<input type="text" name="colum_a2">
							</dd>
							<dt>設定</dt>
							<dd>
								<div id="swradio" class="colum2">
									<input type="radio" name="status" value="1" id="sw0001" checked>
									<label for="sw0001">一般公開</label>
									<input type="radio" name="status" value="2" id="sw0002">
									<label for="sw0002">公開しない</label>
								</div>
							</dd>
							<dt>その他説明</dt>
							<dd>
								<textarea name="caption" class="h200"></textarea>
							</dd>
						</dl>
						<div class="error-message total"></div>
					</div>
				</div>
			</div>
			<div class="tr h50 controls">
				<div class="t_cell">
					<ul class="float m5">
						<li><a href="table1_list.html" class="buttons">戻る</a></li>
						<li class="f_right"><input type="submit" value="レコードを登録する" class="buttons submit_btn"></li>
					</ul>
				</div>
			</div>
		</div>
	</form>
</div>
<script type="text/javascript">
$(function(){

	//URL LIST..
	var url_get_table1="v1/get_table1";
	var url_submit="v1/edit_table1";
	var url_redirect="table1_list.html";

	var get=Params.get();
	if(get!=null){
		if(get["id"]){
			var post={
				access_token:JSession.read("token_"+API.authcode)
			};

			$.ajax({
				url:API.domain+url_get_table1+"/"+get["id"],
				type:"post",
				data:post,
				success:function(data){
					var result=JSON.parse(data);
					
					if(result.Table1){
						$("input[name=id]").val(result.Table1.id);
						$("input[name=name]").val(result.Table1.name);
						$("input[name=colum_a1]").val(result.Table1.colum_a1);
						$("input[name=colum_a2]").val(result.Table1.colum_a2);
						$("input[name=status]").val([result.Table1.status]);
						$("textarea[name=caption]").val(result.Table1.caption);
					}
				}
			});
		}
	}

	//SUBMIT
	$(".submit_btn").on("click",function(){
		$(".error-message").removeClass("active").text("");

		var post=$(".submit_form").Formdat();
		post.access_token=JSession.read("token_"+API.authcode);

		$.ajax({
			url:API.domain+url_submit,
			type:"post",
			data:post,
			success:function(data){
				var result=JSON.parse(data);

				if(result.mode==200){
					//go next
					if(result.message){
						JSession.write("alert",result.message);
					}
					location.href=url_redirect;
				}
				else{
					if(result.validate){
						var colums=Object.keys(result.validate);
						for(var us=0;us<colums.length;us++){
							$(".error-message[name="+colums[us]+"]").addClass("active").text(result.validate[colums[us]]);
						}
						$(".error-message.total").addClass("active").text("入力に誤りがあります。再度ご確認ください");
					}
				}
			}
		});
		return false;
	});

});
</script>
</div><!--//.body-->
<div id="Modal">
<div class="basejavar"></div>
</div>
</body>
</html>